# Telegram-бот(CocktailBot)

Этот демонстрационный проект представляет собой простого Telegram-бота, созданного с использованием Spring Boot.

## Описание

Телеграм-бот, который помогает пользователям находить рецепты коктейлей.

### Основные функции:
- **Поиск по одному или нескольким ингредиентам.** Просто отправьте боту названия ингредиентов через запятую (например, `ром, лайм, мята`).
- **Определение языка запроса.** Бот автоматически определяет, на каком языке (русском или английском) введены ингредиенты.
- **Умный перевод.**
    - Если запрос сделан на **русском**, бот переводит ингредиенты на английский с помощью сервиса **LibreTranslate** и ищет их в англоязычной базе данных [TheCocktailDB](https://www.thecocktaildb.com/).
    - Если запрос сделан на **английском**, поиск выполняется напрямую, без перевода.
- **Детальные рецепты.** После поиска вы получаете список коктейлей. Нажав на любой из них, вы увидите полный рецепт с инструкциями и дозировками, переведенными на русский язык.

## CI/CD Процесс

Проект использует GitHub Actions для автоматизации сборки, тестирования, анализа качества кода и развертывания. Весь процесс описан в файле `.github/workflows/check.yml` и состоит из трёх основных этапов (jobs), которые выполняются последовательно.

### Триггеры запуска

Рабочий процесс (workflow) запускается автоматически в следующих случаях:
- **Push**: При отправке коммитов в ветки `master` или `CI`.
- **Pull Request**: При создании или обновлении pull request, нацеленного на ветку `master`.
- **Вручную**: Может быть запущен вручную через интерфейс GitHub Actions (`workflow_dispatch`).

### 1. Сборка и Тестирование (`build-and-test`)

Это первый и обязательный этап.

1.  **Настройка среды**: Запускается на виртуальной машине с `ubuntu-latest`.
2.  **Загрузка кода**: Код репозитория загружается в рабочую среду.
3.  **Установка Java**: Устанавливается `JDK 18` (Temurin).
4.  **Сборка с Maven**: Выполняется команда `mvn -B package`, которая компилирует код, запускает тесты и упаковывает приложение в JAR-файл.
5.  **Сохранение артефакта**: Собранный JAR-файл (и другие файлы из папки `target/`) сохраняется как артефакт с именем `app-artifact`. Это позволяет передать результат сборки на следующие этапы.

### 2. Анализ качества кода (`qodana`)

Этот этап запускается только после успешного завершения `build-and-test`.

1.  **Загрузка кода**: Снова загружается код репозитория с полной историей коммитов (`fetch-depth: 0`), что необходимо для качественного анализа pull request'ов.
2.  **Qodana Scan**: Запускается статический анализатор кода [Qodana](https://www.jetbrains.com/qodana/) от JetBrains.
    - Он выполняет полное сканирование проекта (`pr-mode: false`).
    - Результаты анализа отправляются в [Qodana Cloud](https://qodana.cloud/) с использованием `QODANA_TOKEN`, который хранится в секретах репозитория.
    - Анализатор также публикует результаты в виде комментариев к pull request и обновляет статусы проверок на GitHub.

### 3. Сборка и запуск Docker-контейнеров (`docker-build-and-run`)

Этот этап также зависит от успешной сборки (`build-and-test`) и выполняется параллельно с анализом Qodana.

1.  **Загрузка кода**: Загружается код репозитория.
2.  **Загрузка артефакта**: Ранее сохраненный `app-artifact` (содержащий JAR-файл) загружается в папку `target/`.
3.  **Настройка Docker Buildx**: Настраивается расширенный сборщик Docker.
4.  **Сборка и запуск**: Выполняется команда `docker compose up --build -d`, которая:
    - Собирает Docker-образы для сервисов, описанных в `docker-compose.yml` (включая `telegram-bot` и `libretranslate`).
    - Запускает контейнеры в фоновом режиме (`-d`).
5.  **Проверка контейнеров**: После 60-секундной паузы (чтобы дать контейнерам время запуститься), выводятся логи запущенных контейнеров для проверки их состояния.

Этот CI/CD пайплайн обеспечивает полную проверку кода на каждом этапе: от компиляции и тестов до статического анализа и проверки успешного запуска в Docker-окружении.

## Технологии
В проекте используются следующие технологии:

*   ***Java 18***: Основной язык программирования.
*   ***Spring Boot***: Фреймворк для создания автономных приложений на основе Spring.
*   ***Telegram Bots***: Библиотека для взаимодействия с Telegram Bot API.
*   ***Lombok***: Библиотека для сокращения шаблонного кода в Java.
*   ***Maven***: Инструмент для сборки и управления зависимостями.
*   ***Docker***: Инструмент для упаковки приложения и его зависимостей в контейнеры.
*   ***LibreTranslate***: Сервис перевода текста.
*   ***TheCocktailDB***: API сервис для поиска коктейлей по ингредиентам.




## Как запустить
### Запуск приложения через (IDE)

1.  С клонируйте репозиторий.
2.  Откройте проект в вашей IDE.
3.  Выполнить настройку **application.properties** в папке **src/main/resources**
    *  ***bot.name*** - имя бота
    *  ***bot.token*** - токен бота
4.  Установить и запустить в Docker LibreTranslate, через командную консоль **#docker run -ti -p 5000:5000 libretranslate/libretranslate:latest**
5.  Запустите приложение и свой Telegram-бот.

### Запуск приложения через (Docker)

1.  С клонируйте репозиторий.
2.  Убедитесь, что свободны следующие порты:
    *  ***8080*** - Java - приложения
    *  ***5000*** - LibreTranslate
3.  Выполнить настройку **application.properties** в папке **src/main/resources**
    *  ***bot.name*** - имя бота
    *  ***bot.token*** - токен бота
4.  Выполнить команду в консоли docker-compose up или запустить docker-compose через IDE
5.  Дождаться билда приложения (3-4 минуты в зависимости от скорости интернета) и запуска всех контейнеров
6. Запустите приложение и свой Telegram-бот.

### Файловая структура
## Структура проекта

```text
io.prj3ct.telegramdemobot
+-- TelegramBotApplication.java     // Главный класс приложения Spring Boot
+-- config                          // Пакет с конфигурационными классами
|   +-- AppConfig.java              // Общая конфигурация приложения (бины, RestTemplate)
|   +-- BotConfig.java              // Конфигурация для Telegram-бота (токен, имя)
|   +-- BotInitializer.java         // Инициализация и регистрация бота
|   +-- TranslationConfig.java      // Конфигурация для сервиса перевода
+-- dto                             // Data Transfer Objects (Объекты для передачи данных)
|   +-- Cocktail.java               // DTO для общего списка коктейлей
|   +-- CocktailDetails.java        // DTO для детальной информации о коктейле
+-- model                           // Модели данных (сущности для БД)
|   +-- CocktailCache.java          // Сущность для кеширования коктейлей в базе данных
+-- repository                      // Репозитории для работы с базой данных
|   +-- CocktailCacheRepository.java// Репозиторий для доступа к кешу коктейлей
+-- service                         // Сервисный слой с бизнес-логикой
    +-- CocktailApiClient.java      // Интерфейс для клиента API TheCocktailDB
    +-- CocktailApiDataParser.java  // Парсер для обработки JSON-ответов от API
    +-- CocktailDBService.java      // Основной сервис, управляющий логикой поиска и перевода коктейлей
    +-- CocktailDbClient.java       // Реализация клиента для TheCocktailDB API
    +-- ImageService.java           // Сервис для загрузки изображений
    +-- TelegramBot.java            // Основной класс, отвечающий за логику работы Telegram-бота
    +-- TranslationService.java     // Сервис для перевода текста через LibreTranslate API
    +-- command                     // Пакет для реализации команд бота (/start и т.д.)
```
